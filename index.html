<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Vocabulary Tester</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36D399',
                        danger: '#F87272',
                        neutral: '#F3F4F6',
                        dark: '#1F2937'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            .transition-custom {
                transition: all 0.3s ease;
            }
            .option-hover {
                @apply hover:bg-primary/5 transition-all duration-200 cursor-pointer;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-dark">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-md fixed top-0 left-0 right-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-book text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-primary">VocabMaster</h1>
            </div>
            
            <nav class="hidden md:flex space-x-6">
                <button id="nav-import" class="nav-btn active py-2 font-medium text-primary border-b-2 border-primary">
                    <i class="fa fa-upload mr-1"></i> Import
                </button>
                <button id="nav-manage" class="nav-btn py-2 font-medium text-gray-600 hover:text-primary transition-custom">
                    <i class="fa fa-list mr-1"></i> Manage
                </button>
                <button id="nav-test" class="nav-btn py-2 font-medium text-gray-600 hover:text-primary transition-custom">
                    <i class="fa fa-check-square-o mr-1"></i> Test
                </button>
                <button id="nav-mistakes" class="nav-btn py-2 font-medium text-gray-600 hover:text-primary transition-custom">
                    <i class="fa fa-exclamation-triangle mr-1"></i> Mistakes
                </button>
                <button id="nav-results" class="nav-btn py-2 font-medium text-gray-600 hover:text-primary transition-custom">
                    <i class="fa fa-bar-chart mr-1"></i> Results
                </button>
            </nav>
            
            <button id="mobile-menu-btn" class="md:hidden text-gray-600 focus:outline-none">
                <i class="fa fa-bars text-xl"></i>
            </button>
        </div>
        
        <!-- 移动端菜单 -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <button id="mobile-import" class="mobile-nav-btn active py-2 font-medium text-left text-primary">
                    <i class="fa fa-upload mr-2"></i> Import Words
                </button>
                <button id="mobile-manage" class="mobile-nav-btn py-2 font-medium text-left text-gray-600">
                    <i class="fa fa-list mr-2"></i> Manage Words
                </button>
                <button id="mobile-test" class="mobile-nav-btn py-2 font-medium text-left text-gray-600">
                    <i class="fa fa-check-square-o mr-2"></i> Take Test
                </button>
                <button id="mobile-mistakes" class="mobile-nav-btn py-2 font-medium text-left text-gray-600">
                    <i class="fa fa-exclamation-triangle mr-2"></i> Mistake Words
                </button>
                <button id="mobile-results" class="mobile-nav-btn py-2 font-medium text-left text-gray-600">
                    <i class="fa fa-bar-chart mr-2"></i> Test Results
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 pt-24 pb-16 min-h-screen">
        <!-- 导入单词模块 -->
        <section id="import-section" class="section active">
            <div class="max-w-3xl mx-auto">
                <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                        <i class="fa fa-upload text-primary mr-3"></i> Import Vocabulary Words
                    </h2>
                    
                    <div class="space-y-6">
                        <!-- 文本区域导入 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Enter words (one per line, format: English,Chinese)
                            </label>
                            <textarea 
                                id="words-textarea" 
                                rows="6" 
                                placeholder="example,例子&#10;vocabulary,词汇&#10;..."
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom"
                            ></textarea>
                            <button id="import-text-btn" class="mt-3 bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom">
                                <i class="fa fa-check mr-1"></i> Import from Text
                            </button>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Or import from Excel/CSV file
                            </label>
                            <div class="flex items-center">
                                <label for="file-upload" class="flex items-center justify-center w-full px-6 py-3 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-custom">
                                    <i class="fa fa-file-excel-o text-gray-500 mr-2"></i>
                                    <span class="text-sm text-gray-600">Select Excel/CSV file</span>
                                    <input id="file-upload" type="file" class="hidden" accept=".xlsx,.xls,.csv" />
                                </label>
                            </div>
                            <p class="mt-2 text-xs text-gray-500">
                                File should contain two columns: English and Chinese
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- 导入结果 -->
                <div id="import-results" class="bg-white rounded-xl shadow-lg p-6 md:p-8 hidden">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
                        <i class="fa fa-check-circle text-primary mr-2"></i> Import Results
                    </h3>
                    
                    <div id="import-success" class="mb-4 hidden">
                        <div class="p-4 bg-green-50 border border-green-200 rounded-lg mb-4">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <i class="fa fa-check-circle text-green-500 mt-0.5"></i>
                                </div>
                                <div class="ml-3">
                                    <h4 class="text-sm font-medium text-green-800">Import successful</h4>
                                    <div class="mt-2 text-sm text-green-700">
                                        <p><span id="imported-count">0</span> words imported successfully</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="import-errors" class="hidden">
                        <div class="p-4 bg-red-50 border border-red-200 rounded-lg mb-4">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <i class="fa fa-exclamation-circle text-red-500 mt-0.5"></i>
                                </div>
                                <div class="ml-3">
                                    <h4 class="text-sm font-medium text-red-800">Import errors</h4>
                                    <div class="mt-2 text-sm text-red-700">
                                        <p><span id="errors-count">0</span> errors occurred</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="errors-list" class="text-sm text-gray-600 space-y-2 max-h-60 overflow-auto"></div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button id="close-import-results" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-lg transition-custom">
                            Close
                        </button>
                        <button id="go-to-manage-btn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom">
                            <i class="fa fa-list mr-1"></i> Manage Words
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 单词管理模块 -->
        <section id="manage-section" class="section hidden">
            <div class="max-w-5xl mx-auto bg-white rounded-xl shadow-lg p-6 md:p-8">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fa fa-list text-primary mr-3"></i> Manage Vocabulary Words
                    </h2>
                    
                    <div class="mt-4 md:mt-0 flex flex-col sm:flex-row gap-3">
                        <div class="relative">
                            <input 
                                id="search-words" 
                                type="text" 
                                placeholder="Search words..." 
                                class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom w-full sm:w-64"
                            >
                            <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <button id="add-word-btn" class="bg-secondary hover:bg-secondary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom">
                            <i class="fa fa-plus mr-1"></i> Add Word
                        </button>
                        <button id="export-words-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-custom disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fa fa-download mr-1"></i> Export
                        </button>
                        <button id="clear-words-btn" class="bg-danger hover:bg-danger/90 text-white font-medium py-2 px-4 rounded-lg transition-custom disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fa fa-trash mr-1"></i> Clear All
                        </button>
                    </div>
                </div>
                
                <div id="no-words-message" class="hidden py-16 text-center">
                    <i class="fa fa-book text-5xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500 text-lg">No vocabulary words found.</p>
                    <p class="text-gray-400 mt-2">Import or add words to get started.</p>
                    <button id="go-to-import-btn" class="mt-4 bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom">
                        <i class="fa fa-upload mr-1"></i> Import Words
                    </button>
                </div>
                
                <div id="words-container" class="overflow-auto max-h-[60vh] rounded-lg border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50 sticky top-0 z-10">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12">
                                    <input type="checkbox" id="select-all-words" class="text-primary focus:ring-primary rounded">
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">English</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Chinese</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Added Date</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="words-list" class="bg-white divide-y divide-gray-200">
                            <!-- 单词列表将在这里动态添加 -->
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-4 flex justify-between items-center">
                    <p class="text-sm text-gray-600">
                        <span id="total-words">0</span> words in total
                    </p>
                    <button id="delete-selected-btn" class="bg-danger hover:bg-danger/90 text-white font-medium py-2 px-4 rounded-lg transition-custom disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fa fa-trash mr-1"></i> Delete Selected
                    </button>
                </div>
            </div>
        </section>

        <!-- 测试模块 -->
        <section id="test-section" class="section hidden">
            <div class="max-w-2xl mx-auto">
                <!-- 测试设置 -->
                <div id="test-settings" class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                        <i class="fa fa-cog text-primary mr-3"></i> Test Settings
                    </h2>
                    
                    <div class="space-y-5">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Test Type</label>
                            <div class="grid grid-cols-1 gap-3">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="test-type" value="english-to-chinese-multiple" class="text-primary focus:ring-primary" checked>
                                    <span class="ml-2 text-gray-700">English → Chinese (Multiple Choice)</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="test-type" value="chinese-to-english-multiple" class="text-primary focus:ring-primary">
                                    <span class="ml-2 text-gray-700">Chinese → English (Multiple Choice)</span>
                                </label>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Order</label>
                            <div class="flex gap-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="test-order" value="random" class="text-primary focus:ring-primary" checked>
                                    <span class="ml-2 text-gray-700">Random</span>
                                </label>
                            </div>
                        </div>
                        
                        <div>
                            <label for="test-count" class="block text-sm font-medium text-gray-700 mb-1">Number of Words to Test</label>
                            <div class="flex items-center">
                                <input 
                                    type="number" 
                                    id="test-count" 
                                    min="1" 
                                    max="100" 
                                    value="10" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom"
                                >
                                <span class="ml-3 text-gray-500 text-sm" id="max-words-text">max: 0</span>
                            </div>
                        </div>
                        
                        <button id="start-test-btn" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-custom disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fa fa-play mr-2"></i> Start Test
                        </button>
                    </div>
                </div>
                
                <!-- 测试进行中 -->
                <div id="test-in-progress" class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-6 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                            <i class="fa fa-check-square-o text-primary mr-3"></i> Taking Test
                        </h2>
                        <div class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm font-medium">
                            <span id="current-question">1</span>/<span id="total-questions">10</span>
                        </div>
                    </div>
                    
                    <!-- 传统输入式测试 -->
                    <div id="input-test-container" class="mb-8 hidden">
                        <p class="text-gray-500 text-sm mb-2">Question</p>
                        <div class="bg-neutral p-4 rounded-lg mb-6">
                            <p id="test-question" class="text-xl font-medium text-gray-800"></p>
                        </div>
                        
                        <p class="text-gray-500 text-sm mb-2">Your Answer</p>
                        <input 
                            type="text" 
                            id="test-answer" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom"
                            placeholder="Type your answer here..."
                        >
                    </div>
                    
                    <!-- 选择题测试 -->
                    <div id="multiple-choice-container" class="mb-8 hidden">
                        <p class="text-gray-500 text-sm mb-2">Question</p>
                        <div class="bg-neutral p-4 rounded-lg mb-6">
                            <p id="mc-question" class="text-xl font-medium text-gray-800"></p>
                        </div>
                        
                        <p class="text-gray-500 text-sm mb-2">Choose the correct answer</p>
                        <div id="options-container" class="space-y-3">
                            <!-- 选项将在这里动态添加 -->
                        </div>
                    </div>
                    
                    <!-- 句子填空测试 -->
                    <div id="sentence-test-container" class="mb-8 hidden">
                        <p class="text-gray-500 text-sm mb-2">Complete the sentence</p>
                        <div class="bg-neutral p-4 rounded-lg mb-6">
                            <p id="sentence-question" class="text-xl font-medium text-gray-800"></p>
                        </div>
                        
                        <p class="text-gray-500 text-sm mb-2">Choose the correct word</p>
                        <div id="sentence-options-container" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <!-- 选项将在这里动态添加 -->
                        </div>
                    </div>
                    
                    <div id="test-navigation" class="flex justify-between">
                        <button id="skip-question-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-6 rounded-lg transition-custom">
                            Skip
                        </button>
                        <button id="submit-answer-btn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition-custom">
                            Submit Answer
                        </button>
                    </div>
                    
                    <!-- 答案反馈 -->
                    <div id="answer-feedback" class="mt-6 p-4 rounded-lg hidden">
                        <div class="flex items-start">
                            <i id="feedback-icon" class="text-xl mt-0.5 mr-3"></i>
                            <div>
                                <h4 id="feedback-title" class="font-medium"></h4>
                                <p id="feedback-message" class="mt-1 text-gray-600"></p>
                            </div>
                        </div>
                        <button id="next-question-btn" class="mt-4 bg-primary/10 hover:bg-primary/20 text-primary font-medium py-2 px-4 rounded-lg transition-custom">
                            Next Question
                        </button>
                    </div>
                </div>
                
                <!-- 测试结果 -->
                <div id="test-results" class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-6 hidden">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                        <i class="fa fa-check-circle text-primary mr-3"></i> Test Results
                    </h2>
                    
                    <div class="flex flex-col md:flex-row items-center justify-between mb-8">
                        <div class="text-center md:text-left mb-6 md:mb-0">
                            <p class="text-gray-500">Your Score</p>
                            <div class="text-5xl font-bold text-primary mt-1" id="test-score">0%</div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-6 w-full md:w-auto">
                            <div class="text-center">
                                <p class="text-gray-500 text-sm">Total</p>
                                <p class="text-xl font-bold text-gray-800 mt-1" id="result-total">0</p>
                            </div>
                            <div class="text-center">
                                <p class="text-gray-500 text-sm">Correct</p>
                                <p class="text-xl font-bold text-secondary mt-1" id="result-correct">0</p>
                            </div>
                            <div class="text-center">
                                <p class="text-gray-500 text-sm">Incorrect</p>
                                <p class="text-xl font-bold text-danger mt-1" id="result-incorrect">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-6">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">Detailed Results</h3>
                        
                        <div id="detailed-results" class="space-y-4 max-h-[40vh] overflow-auto">
                            <!-- 详细结果将在这里动态添加 -->
                        </div>
                    </div>
                    
                    <div class="mt-8 flex flex-col sm:flex-row justify-between gap-3">
                        <button id="restart-test-btn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition-custom">
                            <i class="fa fa-refresh mr-1"></i> Take Another Test
                        </button>
                        <button id="review-mistakes-btn" class="bg-danger hover:bg-danger/90 text-white font-medium py-2 px-6 rounded-lg transition-custom disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fa fa-exclamation-triangle mr-1"></i> Review Mistakes
                        </button>
                        <button id="save-results-btn" class="bg-secondary hover:bg-secondary/90 text-white font-medium py-2 px-6 rounded-lg transition-custom">
                            <i class="fa fa-save mr-1"></i> Save Results
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 错词表模块 -->
        <section id="mistakes-section" class="section hidden">
            <div class="max-w-5xl mx-auto bg-white rounded-xl shadow-lg p-6 md:p-8">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fa fa-exclamation-triangle text-danger mr-3"></i> Mistake Words
                    </h2>
                    
                    <div class="mt-4 md:mt-0 flex flex-col sm:flex-row gap-3">
                        <div class="relative">
                            <input 
                                id="search-mistakes" 
                                type="text" 
                                placeholder="Search mistake words..." 
                                class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom w-full sm:w-64"
                            >
                            <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <button id="clear-mistakes-btn" class="bg-danger hover:bg-danger/90 text-white font-medium py-2 px-4 rounded-lg transition-custom disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fa fa-trash mr-1"></i> Clear All
                        </button>
                    </div>
                </div>
                
                <div id="no-mistakes-message" class="hidden py-16 text-center">
                    <i class="fa fa-check-circle text-5xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500 text-lg">No mistake words found.</p>
                    <p class="text-gray-400 mt-2">Keep practicing to avoid mistakes!</p>
                </div>
                
                <div id="mistakes-container" class="overflow-auto max-h-[60vh] rounded-lg border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50 sticky top-0 z-10">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">English</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Chinese</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mistake Count</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Correct Streak</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="mistakes-list" class="bg-white divide-y divide-gray-200">
                            <!-- 错词列表将在这里动态添加 -->
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-4 flex justify-between items-center">
                    <p class="text-sm text-gray-600">
                        <span id="mistakes-count">0</span> words in mistake list
                    </p>
                    <button id="test-mistakes-btn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fa fa-check-square-o mr-1"></i> Test Mistake Words
                    </button>
                </div>
            </div>
        </section>

        <!-- 测试结果历史模块 -->
        <section id="results-section" class="section hidden">
            <div class="max-w-5xl mx-auto">
                <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                        <i class="fa fa-bar-chart text-primary mr-3"></i> Test Results History
                    </h2>
                    
                    <div id="no-results-message" class="hidden py-16 text-center">
                        <i class="fa fa-line-chart text-5xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">No test results found.</p>
                        <p class="text-gray-400 mt-2">Take a test to view your progress.</p>
                        <button id="go-to-test-btn" class="mt-4 bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom">
                            <i class="fa fa-check-square-o mr-1"></i> Take a Test
                        </button>
                    </div>
                    
                    <div id="results-chart-container" class="mb-8 h-64 hidden">
                        <canvas id="results-chart"></canvas>
                    </div>
                    
                    <div class="overflow-auto rounded-lg border border-gray-200">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50 sticky top-0 z-10">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Test Type</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Words</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Correct</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Incorrect</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="results-list" class="bg-white divide-y divide-gray-200">
                                <!-- 测试结果列表将在这里动态添加 -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-4 flex justify-end">
                        <button id="clear-results-btn" class="bg-danger hover:bg-danger/90 text-white font-medium py-2 px-4 rounded-lg transition-custom disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fa fa-trash mr-1"></i> Clear History
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 添加单词对话框 -->
    <div id="add-word-dialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 transform transition-all">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">Add New Word</h3>
                    <button id="close-add-word" class="text-gray-400 hover:text-gray-500">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label for="new-word-english" class="block text-sm font-medium text-gray-700 mb-1">English Word</label>
                        <input 
                            type="text" 
                            id="new-word-english" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom"
                            placeholder="Enter English word"
                        >
                    </div>
                    
                    <div>
                        <label for="new-word-chinese" class="block text-sm font-medium text-gray-700 mb-1">Chinese Translation</label>
                        <input 
                            type="text" 
                            id="new-word-chinese" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom"
                            placeholder="Enter Chinese translation"
                        >
                    </div>
                </div>
            </div>
            
            <div class="bg-gray-50 px-6 py-3 rounded-b-xl flex justify-end space-x-3">
                <button id="cancel-add-word" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-lg transition-custom">
                    Cancel
                </button>
                <button id="save-new-word" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom">
                    Save Word
                </button>
            </div>
        </div>
    </div>

    <!-- 确认对话框 -->
    <div id="confirm-dialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 transform transition-all">
            <div class="p-6">
                <h3 id="confirm-title" class="text-lg font-semibold text-gray-800 mb-2">Confirm Action</h3>
                <p id="confirm-message" class="text-gray-600">Are you sure you want to perform this action?</p>
            </div>
            
            <div class="bg-gray-50 px-6 py-3 rounded-b-xl flex justify-end space-x-3">
                <button id="confirm-cancel" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-lg transition-custom">
                    Cancel
                </button>
                <button id="confirm-ok" class="bg-danger hover:bg-danger/90 text-white font-medium py-2 px-4 rounded-lg transition-custom">
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-6">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-2 mb-4 md:mb-0">
                    <i class="fa fa-book text-primary text-xl"></i>
                    <span class="text-lg font-bold">VocabMaster</span>
                </div>
                
                <div class="text-gray-400 text-sm">
                    &copy; 2023 VocabMaster. All rights reserved.
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        // 句子库 - 用于句子填空测试
        const SentenceBank = {
            sentences: [
                { sentence: "I need to ______ new words every day to improve my vocabulary.", word: "learn" },
                { sentence: "Can you ______ this English word into Chinese?", word: "translate" },
                { sentence: "Reading books helps to ______ your vocabulary.", word: "expand" },
                { sentence: "She has an excellent ______ of English words.", word: "knowledge" },
                { sentence: "The teacher asked us to ______ the new words five times.", word: "write" },
                { sentence: "I can't ______ the meaning of this word.", word: "understand" },
                { sentence: "He tried to ______ the difficult word in a sentence.", word: "use" },
                { sentence: "Memorizing words is an important part of language ______.", word: "learning" },
                { sentence: "The ______ of this word is difficult to remember.", word: "spelling" },
                { sentence: "I need to ______ my vocabulary before the English exam.", word: "review" }
            ],
            
            getSentenceForWord(word) {
                // 尝试找到包含指定单词的句子
                const lowerWord = word.toLowerCase();
                const found = this.sentences.find(s => 
                    s.word.toLowerCase() === lowerWord
                );
                
                if (found) {
                    return {
                        sentence: found.sentence.replace(found.word, "[______]"),
                        word: found.word
                    };
                }
                
                // 如果没有找到，返回null
                return null;
            },
            
            createOptions(correctWord, allWords, count = 4) {
                // 收集其他可能的选项
                const otherWords = allWords
                    .filter(w => w.english.toLowerCase() !== correctWord.toLowerCase())
                    .map(w => w.english)
                    .slice(0, count - 1);
                
                // 组合并打乱选项
                const options = [correctWord, ...otherWords]
                    .sort(() => 0.5 - Math.random());
                
                return options;
            }
        };

        // 错词管理
        const MistakeManager = {
            // 获取所有错词
            getMistakes() {
                const mistakes = localStorage.getItem('vocabMistakes');
                return mistakes ? JSON.parse(mistakes) : [];
            },
            
            // 保存错词
            saveMistakes(mistakes) {
                localStorage.setItem('vocabMistakes', JSON.stringify(mistakes));
                this.triggerUpdate();
            },
            
            // 添加错词（如果不存在则添加，存在则增加错误计数）
            addMistake(wordId, english, chinese) {
                const mistakes = this.getMistakes();
                const existingIndex = mistakes.findIndex(m => m.wordId === wordId);
                
                if (existingIndex >= 0) {
                    // 已存在，增加错误计数，重置正确连续计数
                    mistakes[existingIndex] = {
                        ...mistakes[existingIndex],
                        mistakeCount: mistakes[existingIndex].mistakeCount + 1,
                        correctStreak: 0
                    };
                } else {
                    // 新错词
                    mistakes.push({
                        wordId,
                        english,
                        chinese,
                        mistakeCount: 1,
                        correctStreak: 0,
                        addedDate: new Date().toISOString().split('T')[0]
                    });
                }
                
                this.saveMistakes(mistakes);
            },
            
            // 记录正确答案
            recordCorrectAnswer(wordId) {
                const mistakes = this.getMistakes();
                const existingIndex = mistakes.findIndex(m => m.wordId === wordId);
                
                if (existingIndex >= 0) {
                    // 增加正确连续计数
                    const updatedStreak = mistakes[existingIndex].correctStreak + 1;
                    
                    if (updatedStreak >= 3) {
                        // 连续答对3次，从错词表中移除
                        mistakes.splice(existingIndex, 1);
                    } else {
                        // 更新正确连续计数
                        mistakes[existingIndex].correctStreak = updatedStreak;
                    }
                    
                    this.saveMistakes(mistakes);
                }
            },
            
            // 移除错词
            removeMistake(wordId) {
                let mistakes = this.getMistakes();
                mistakes = mistakes.filter(m => m.wordId !== wordId);
                this.saveMistakes(mistakes);
            },
            
            // 清空所有错词
            clearAllMistakes() {
                this.saveMistakes([]);
            },
            
            // 搜索错词
            searchMistakes(query) {
                if (!query) return this.getMistakes();
                const lowerQuery = query.toLowerCase();
                return this.getMistakes().filter(m => 
                    m.english.toLowerCase().includes(lowerQuery) || 
                    m.chinese.toLowerCase().includes(lowerQuery)
                );
            },
            
            // 事件触发器
            triggerUpdate() {
                const event = new Event('mistakesUpdated');
                document.dispatchEvent(event);
            }
        };

        // 数据存储和管理
        const VocabData = {
            // 获取所有单词
            getWords() {
                const words = localStorage.getItem('vocabWords');
                return words ? JSON.parse(words) : [];
            },
            
            // 保存单词
            saveWords(words) {
                localStorage.setItem('vocabWords', JSON.stringify(words));
                this.triggerUpdate();
            },
            
            // 添加单词
            addWord(word) {
                const words = this.getWords();
                // 检查是否已存在相同的英文单词
                const existingIndex = words.findIndex(w => w.english.toLowerCase() === word.english.toLowerCase());
                
                if (existingIndex >= 0) {
                    // 更新已存在的单词
                    words[existingIndex] = {
                        ...words[existingIndex],
                        ...word,
                        id: words[existingIndex].id // 保持原ID
                    };
                } else {
                    // 添加新单词
                    const newWord = {
                        id: Date.now(),
                        english: word.english.trim(),
                        chinese: word.chinese ? word.chinese.trim() : '',
                        addedDate: new Date().toISOString().split('T')[0]
                    };
                    words.push(newWord);
                }
                
                this.saveWords(words);
                return true;
            },
            
            // 批量添加单词
            addWords(words) {
                const results = [];
                words.forEach(word => {
                    try {
                        this.addWord(word);
                        results.push({
                            ...word,
                            status: 'success'
                        });
                    } catch (error) {
                        results.push({
                            ...word,
                            status: 'error',
                            error: error.message
                        });
                    }
                });
                return results;
            },
            
            // 删除单词
            deleteWord(id) {
                let words = this.getWords();
                words = words.filter(word => word.id !== id);
                this.saveWords(words);
                
                // 同时从错词表中删除
                MistakeManager.removeMistake(id);
            },
            
            // 批量删除单词
            deleteWords(ids) {
                let words = this.getWords();
                words = words.filter(word => !ids.includes(word.id));
                this.saveWords(words);
                
                // 同时从错词表中删除
                ids.forEach(id => MistakeManager.removeMistake(id));
            },
            
            // 清空所有单词
            clearAllWords() {
                this.saveWords([]);
                MistakeManager.clearAllMistakes();
            },
            
            // 搜索单词
            searchWords(query) {
                if (!query) return this.getWords();
                const lowerQuery = query.toLowerCase();
                return this.getWords().filter(word => 
                    word.english.toLowerCase().includes(lowerQuery) || 
                    word.chinese.toLowerCase().includes(lowerQuery)
                );
            },
            
            // Fisher-Yates 洗牌算法 - 提供更好的随机性和浏览器兼容性
            shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            },
            
            // 优先从错词表中抽取单词，然后补充普通单词
            getPrioritizedWords(count) {
                const allWords = this.getWords();
                if (allWords.length === 0) return [];
                
                const mistakes = MistakeManager.getMistakes();
                const mistakeWordIds = mistakes.map(m => m.wordId);
                
                // 获取错词表中的单词
                const mistakeWords = allWords.filter(word => mistakeWordIds.includes(word.id));
                // 获取非错词表中的单词
                const regularWords = allWords.filter(word => !mistakeWordIds.includes(word.id));
                
                // 打乱两个列表 - 使用Fisher-Yates洗牌算法确保在所有浏览器中都能获得良好的随机性
                const shuffledMistakes = this.shuffleArray([...mistakeWords]);
                const shuffledRegulars = this.shuffleArray([...regularWords]);
                
                // 优先从错误单词列表中抽取所有单词，单词库中其他单词被抽取的概率是一样的
                const result = [];
                
                // 1. 先添加所有错词（如果数量不超过需求）
                const mistakesToAdd = Math.min(count, shuffledMistakes.length);
                result.push(...shuffledMistakes.slice(0, mistakesToAdd));
                
                // 2. 如果还需要更多单词，从普通单词中随机抽取
                if (result.length < count) {
                    const regularsNeeded = count - result.length;
                    // 确保不会超过可用的普通单词数量
                    const regularsToAdd = Math.min(regularsNeeded, shuffledRegulars.length);
                    result.push(...shuffledRegulars.slice(0, regularsToAdd));
                }
                
                return result;
            },
            
            // 获取随机中文释义选项（增加到6项）
            getRandomChineseOptions(correctChinese, count = 6) {
                const allWords = this.getWords();
                
                // 筛选出与正确答案不同的单词
                const otherWords = allWords
                    .filter(w => w.chinese && w.chinese.toLowerCase() !== correctChinese.toLowerCase())
                    .map(w => w.chinese);
                
                // 如果可用选项不足，减少数量
                const actualCount = Math.min(count, otherWords.length + 1);
                if (actualCount < 2) return [correctChinese];
                
                // 随机选择其他选项
                const shuffled = this.shuffleArray([...otherWords]);
                const options = [correctChinese, ...shuffled.slice(0, actualCount - 1)];
                
                // 打乱选项顺序
                return this.shuffleArray(options);
            },
            
            // 获取随机英文选项（抽取5个英文单词搭配正确单词）
            getRandomEnglishOptions(correctEnglish, count = 6) {
                const allWords = this.getWords();
                
                // 筛选出与正确答案不同的单词
                const otherWords = allWords
                    .filter(w => w.english && w.english.toLowerCase() !== correctEnglish.toLowerCase())
                    .map(w => w.english);
                
                // 如果可用选项不足，减少数量
                const actualCount = Math.min(count, otherWords.length + 1);
                if (actualCount < 2) return [correctEnglish];
                
                // 随机选择其他选项（从单词表中随机抽5个英文单词）
                const shuffled = this.shuffleArray([...otherWords]);
                const options = [correctEnglish, ...shuffled.slice(0, actualCount - 1)];
                
                // 打乱选项顺序
                return this.shuffleArray(options);
            },
            
            // 事件触发器
            triggerUpdate() {
                const event = new Event('wordsUpdated');
                document.dispatchEvent(event);
            }
        };

        // 测试管理
        const TestManager = {
            currentTest: null,
            currentQuestionIndex: 0,
            testResults: [],
            
            // 开始新测试
            startTest(settings) {
                const { testType, order, count, words } = settings;
                let testWords = [];
                
                // 如果提供了自定义单词列表，则使用它
                if (words && words.length > 0) {
                    testWords = words;
                } else {
                    // 根据顺序类型获取单词
                    if (order === 'random') {
                        // 优先从错词表中获取
                        testWords = VocabData.getPrioritizedWords(count);
                    } else {
                        // 顺序获取
                        testWords = VocabData.getWords().slice(0, count);
                    }
                }
                
                this.currentTest = {
                    settings,
                    words: testWords,
                    totalQuestions: testWords.length
                };
                
                this.currentQuestionIndex = 0;
                this.testResults = [];
                
                return this.currentTest;
            },
            
            // 获取当前问题
            getCurrentQuestion() {
                // 确保currentTest和currentQuestionIndex正确初始化
                if (!this.currentTest || typeof this.currentQuestionIndex === 'undefined' || this.currentQuestionIndex === null || this.currentQuestionIndex >= this.currentTest.words.length) {
                    return null;
                }
                
                const word = this.currentTest.words[this.currentQuestionIndex];
                const testType = this.currentTest.settings.testType;
                
                // 根据测试类型生成问题
                switch (testType) {
                    case 'english-to-chinese':
                        return {
                            type: testType,
                            question: word.english,
                            correctAnswer: word.chinese,
                            wordId: word.id
                        };
                        
                    case 'chinese-to-english':
                        return {
                            type: testType,
                            question: word.chinese,
                            correctAnswer: word.english,
                            wordId: word.id
                        };
                        
                    case 'english-to-chinese-multiple':
                        // 获取6个选项
                        const options = VocabData.getRandomChineseOptions(word.chinese, 6);
                        return {
                            type: testType,
                            question: word.english,
                            correctAnswer: word.chinese,
                            options: options,
                            wordId: word.id
                        };
                        
                    case 'chinese-to-english-multiple':
                        // 获取6个选项（正确单词+5个随机英文单词）
                        const englishOptions = VocabData.getRandomEnglishOptions(word.english, 6);
                        return {
                            type: testType,
                            question: word.chinese,
                            correctAnswer: word.english,
                            options: englishOptions,
                            wordId: word.id
                        };
                        
                    case 'sentence-completion':
                        // 句子填空测试
                        const sentence = SentenceBank.getSentenceForWord(word.english) || 
                                        { sentence: `The word "[______]" means ${word.chinese}.`, word: word.english };
                                        
                        const sentenceOptions = SentenceBank.createOptions(
                            word.english, 
                            VocabData.getWords()
                        );
                        
                        return {
                            type: testType,
                            question: sentence.sentence,
                            correctAnswer: word.english,
                            options: sentenceOptions,
                            wordId: word.id
                        };
                }
            },
            
            // 提交答案
            submitAnswer(userAnswer) {
                const question = this.getCurrentQuestion();
                if (!question) return null;
                
                // 判断答案是否正确（不区分大小写）
                const isCorrect = userAnswer.toLowerCase() === question.correctAnswer.toLowerCase();
                
                // 记录结果
                const result = {
                    question: question.question,
                    userAnswer: userAnswer,
                    correctAnswer: question.correctAnswer,
                    isCorrect: isCorrect,
                    wordId: question.wordId,
                    english: this.currentTest.words[this.currentQuestionIndex].english,
                    chinese: this.currentTest.words[this.currentQuestionIndex].chinese
                };
                
                this.testResults.push(result);
                
                // 更新错词表
                if (!isCorrect) {
                    MistakeManager.addMistake(
                        question.wordId,
                        this.currentTest.words[this.currentQuestionIndex].english,
                        this.currentTest.words[this.currentQuestionIndex].chinese
                    );
                } else {
                    MistakeManager.recordCorrectAnswer(question.wordId);
                }
                
                // 移动到下一题
                this.currentQuestionIndex++;
                
                return {
                    result,
                    isLastQuestion: this.currentQuestionIndex >= this.currentTest.totalQuestions
                };
            },
            
            // 获取测试结果
            getTestResults() {
                const correctCount = this.testResults.filter(r => r.isCorrect).length;
                const totalCount = this.testResults.length;
                const score = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;
                
                return {
                    date: new Date().toISOString(),
                    score: score,
                    correct: correctCount,
                    incorrect: totalCount - correctCount,
                    total: totalCount,
                    testType: this.currentTest.settings.testType,
                    answers: this.testResults
                };
            }
        };

        // 测试结果管理
        const ResultsManager = {
            // 获取所有测试结果
            getResults() {
                const results = localStorage.getItem('vocabTestResults');
                return results ? JSON.parse(results) : [];
            },
            
            // 保存测试结果
            saveResult(result) {
                const results = this.getResults();
                results.push(result);
                localStorage.setItem('vocabTestResults', JSON.stringify(results));
                this.triggerUpdate();
            },
            
            // 删除单个测试结果
            deleteResult(index) {
                let results = this.getResults();
                results.splice(index, 1);
                localStorage.setItem('vocabTestResults', JSON.stringify(results));
                this.triggerUpdate();
            },
            
            // 清空所有测试结果
            clearAllResults() {
                localStorage.setItem('vocabTestResults', JSON.stringify([]));
                this.triggerUpdate();
            },
            
            // 事件触发器
            triggerUpdate() {
                const event = new Event('resultsUpdated');
                document.dispatchEvent(event);
            }
        };

        // DOM 操作和事件监听
        document.addEventListener('DOMContentLoaded', function() {
            // 导航切换
            const navButtons = document.querySelectorAll('.nav-btn, .mobile-nav-btn');
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // 移除所有活跃状态
                    document.querySelectorAll('.nav-btn, .mobile-nav-btn').forEach(btn => {
                        btn.classList.remove('active', 'text-primary', 'border-b-2', 'border-primary');
                        btn.classList.add('text-gray-600');
                    });
                    
                    // 设置当前按钮为活跃状态
                    this.classList.add('active', 'text-primary');
                    if (this.classList.contains('nav-btn')) {
                        this.classList.add('border-b-2', 'border-primary');
                    }
                    
                    // 隐藏所有区域
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.add('hidden');
                        section.classList.remove('active');
                    });
                    
                    // 显示对应的区域
                    const sectionId = this.id.replace('nav-', '').replace('mobile-', '') + '-section';
                    const section = document.getElementById(sectionId);
                    section.classList.remove('hidden');
                    section.classList.add('active');
                    
                    // 关闭移动菜单
                    document.getElementById('mobile-menu').classList.add('hidden');
                });
            });
            
            // 移动端菜单切换
            document.getElementById('mobile-menu-btn').addEventListener('click', function() {
                const mobileMenu = document.getElementById('mobile-menu');
                mobileMenu.classList.toggle('hidden');
            });
            
            // 搜索单词功能
            document.getElementById('search-words').addEventListener('input', function(e) {
                const query = e.target.value;
                renderWords(query);
            });
            
            // 渲染单词列表
            function renderWords(searchQuery = '') {
                const words = VocabData.searchWords(searchQuery);
                const wordsList = document.getElementById('words-list');
                const noWordsMessage = document.getElementById('no-words-message');
                const totalWords = document.getElementById('total-words');
                const exportBtn = document.getElementById('export-words-btn');
                const clearBtn = document.getElementById('clear-words-btn');
                const deleteSelectedBtn = document.getElementById('delete-selected-btn');
                
                totalWords.textContent = words.length;
                exportBtn.disabled = words.length === 0;
                clearBtn.disabled = words.length === 0;
                deleteSelectedBtn.disabled = true; // 初始禁用
                
                if (words.length === 0) {
                    wordsList.innerHTML = '';
                    noWordsMessage.classList.remove('hidden');
                    return;
                }
                
                noWordsMessage.classList.add('hidden');
                wordsList.innerHTML = '';
                
                words.forEach(word => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-custom';
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap">
                            <input type="checkbox" class="word-checkbox text-primary focus:ring-primary rounded" data-id="${word.id}">
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="font-medium text-gray-900">${word.english}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="text-gray-600">${word.chinese}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="text-gray-500 text-sm">${word.addedDate}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                            <button class="text-primary hover:text-primary/80 edit-word mr-3" data-id="${word.id}">
                                <i class="fa fa-pencil"></i> Edit
                            </button>
                            <button class="text-danger hover:text-danger/80 delete-word" data-id="${word.id}">
                                <i class="fa fa-trash"></i> Delete
                            </button>
                        </td>
                    `;
                    wordsList.appendChild(row);
                });
                
                // 添加复选框事件监听
                document.querySelectorAll('.word-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', updateDeleteSelectedButtonState);
                });
                
                // 添加编辑单词事件监听
                document.querySelectorAll('.edit-word').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const wordId = parseInt(this.getAttribute('data-id'));
                        const words = VocabData.getWords();
                        const word = words.find(w => w.id === wordId);
                        
                        if (word) {
                            document.getElementById('new-word-english').value = word.english;
                            document.getElementById('new-word-chinese').value = word.chinese;
                            document.getElementById('save-new-word').setAttribute('data-edit-id', wordId);
                            document.getElementById('add-word-dialog').classList.remove('hidden');
                        }
                    });
                });
                
                // 添加删除单词事件监听
                document.querySelectorAll('.delete-word').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const wordId = parseInt(this.getAttribute('data-id'));
                        const words = VocabData.getWords();
                        const word = words.find(w => w.id === wordId);
                        
                        if (word) {
                            showConfirmDialog(
                                'Delete Word',
                                `Are you sure you want to delete the word "${word.english}"?`,
                                () => {
                                    VocabData.deleteWord(wordId);
                                }
                            );
                        }
                    });
                });
            }
            
            // 更新删除选中按钮状态
            function updateDeleteSelectedButtonState() {
                const checkedCount = document.querySelectorAll('.word-checkbox:checked').length;
                document.getElementById('delete-selected-btn').disabled = checkedCount === 0;
            }
            
            // 全选/取消全选
            document.getElementById('select-all-words').addEventListener('change', function() {
                const isChecked = this.checked;
                document.querySelectorAll('.word-checkbox').forEach(checkbox => {
                    checkbox.checked = isChecked;
                });
                updateDeleteSelectedButtonState();
            });
            
            // 删除选中单词
            document.getElementById('delete-selected-btn').addEventListener('click', function() {
                const checkedIds = Array.from(document.querySelectorAll('.word-checkbox:checked'))
                    .map(checkbox => parseInt(checkbox.getAttribute('data-id')));
                
                if (checkedIds.length === 0) return;
                
                showConfirmDialog(
                    'Delete Selected Words',
                    `Are you sure you want to delete ${checkedIds.length} selected words?`,
                    () => {
                        VocabData.deleteWords(checkedIds);
                        document.getElementById('select-all-words').checked = false;
                    }
                );
            });
            
            // 清空所有单词
            document.getElementById('clear-words-btn').addEventListener('click', function() {
                showConfirmDialog(
                    'Clear All Words',
                    'Are you sure you want to delete all vocabulary words?',
                    () => {
                        VocabData.clearAllWords();
                        document.getElementById('select-all-words').checked = false;
                    }
                );
            });
            
            // 导出单词
            document.getElementById('export-words-btn').addEventListener('click', function() {
                const words = VocabData.getWords();
                if (words.length === 0) return;
                
                // 准备导出数据
                const exportData = words.map(word => ({
                    'English': word.english,
                    'Chinese': word.chinese,
                    'Added Date': word.addedDate
                }));
                
                // 创建工作簿和工作表
                const ws = XLSX.utils.json_to_sheet(exportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Vocabulary");
                
                // 导出文件
                XLSX.writeFile(wb, "vocabulary_words.xlsx");
            });
            
            // 导入文本单词
            document.getElementById('import-text-btn').addEventListener('click', function() {
                const text = document.getElementById('words-textarea').value.trim();
                if (!text) return;
                
                const lines = text.split('\n');
                const words = [];
                
                lines.forEach((line, index) => {
                    const parts = line.split(',');
                    if (parts.length >= 2) {
                        words.push({
                            english: parts[0].trim(),
                            chinese: parts.slice(1).join(',').trim()
                        });
                    }
                });
                
                if (words.length > 0) {
                    const results = VocabData.addWords(words);
                    showImportResults(results);
                    document.getElementById('words-textarea').value = '';
                }
            });
            
            // 显示导入结果
            function showImportResults(results) {
                const importResults = document.getElementById('import-results');
                const importSuccess = document.getElementById('import-success');
                const importErrors = document.getElementById('import-errors');
                const importedCount = document.getElementById('imported-count');
                const errorsCount = document.getElementById('errors-count');
                const errorsList = document.getElementById('errors-list');
                
                // 统计成功和错误数量
                const successCount = results.filter(r => r.status === 'success').length;
                const errorCount = results.length - successCount;
                
                // 更新UI
                importedCount.textContent = successCount;
                errorsCount.textContent = errorCount;
                
                // 显示/隐藏成功消息
                if (successCount > 0) {
                    importSuccess.classList.remove('hidden');
                } else {
                    importSuccess.classList.add('hidden');
                }
                
                // 显示/隐藏错误消息
                if (errorCount > 0) {
                    importErrors.classList.remove('hidden');
                    errorsList.innerHTML = '';
                    
                    results.forEach((result, index) => {
                        if (result.status === 'error') {
                            const errorItem = document.createElement('div');
                            errorItem.className = 'p-2 bg-red-50 rounded';
                            errorItem.innerHTML = `
                                <p><strong>Line ${index + 1}:</strong> ${result.english || 'Empty'}</p>
                                <p class="text-red-600 text-xs mt-1">${result.error || 'Unknown error'}</p>
                            `;
                            errorsList.appendChild(errorItem);
                        }
                    });
                } else {
                    importErrors.classList.add('hidden');
                }
                
                // 显示结果面板
                importResults.classList.remove('hidden');
            }
            
            // 关闭导入结果
            document.getElementById('close-import-results').addEventListener('click', function() {
                document.getElementById('import-results').classList.add('hidden');
            });
            
            // 前往管理页面
            document.getElementById('go-to-manage-btn').addEventListener('click', function() {
                document.getElementById('import-results').classList.add('hidden');
                document.getElementById('nav-manage').click();
            });
            
            // 前往导入页面
            document.getElementById('go-to-import-btn').addEventListener('click', function() {
                document.getElementById('nav-import').click();
            });
            
            // 文件上传处理
            document.getElementById('file-upload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        // 处理导入的数据
                        const words = [];
                        jsonData.forEach((row, index) => {
                            // 尝试不同的列名组合
                            let english, chinese;
                            
                            if (row.English && row.Chinese) {
                                english = row.English;
                                chinese = row.Chinese;
                            } else if (row.english && row.chinese) {
                                english = row.english;
                                chinese = row.chinese;
                            } else if (row[0] && row[1]) {
                                english = row[0];
                                chinese = row[1];
                            } else {
                                // 无法识别的格式
                                return;
                            }
                            
                            words.push({
                                english: String(english).trim(),
                                chinese: String(chinese).trim()
                            });
                        });
                        
                        if (words.length > 0) {
                            const results = VocabData.addWords(words);
                            showImportResults(results);
                        } else {
                            alert('No valid words found in the file. Please check the file format.');
                        }
                    } catch (error) {
                        console.error('Error importing file:', error);
                        alert('Failed to import file. Please check if it\'s a valid Excel/CSV file.');
                    }
                    
                    // 重置文件输入
                    document.getElementById('file-upload').value = '';
                };
                reader.readAsArrayBuffer(file);
            });
            
            // 添加单词对话框
            document.getElementById('add-word-btn').addEventListener('click', function() {
                document.getElementById('new-word-english').value = '';
                document.getElementById('new-word-chinese').value = '';
                document.getElementById('save-new-word').removeAttribute('data-edit-id');
                document.getElementById('add-word-dialog').classList.remove('hidden');
                document.getElementById('new-word-english').focus();
            });
            
            // 关闭添加单词对话框
            document.getElementById('close-add-word').addEventListener('click', function() {
                document.getElementById('add-word-dialog').classList.add('hidden');
            });
            
            // 取消添加单词
            document.getElementById('cancel-add-word').addEventListener('click', function() {
                document.getElementById('add-word-dialog').classList.add('hidden');
            });
            
            // 保存新单词
            document.getElementById('save-new-word').addEventListener('click', function() {
                const english = document.getElementById('new-word-english').value.trim();
                const chinese = document.getElementById('new-word-chinese').value.trim();
                const editId = this.getAttribute('data-edit-id');
                
                if (!english) {
                    alert('Please enter an English word.');
                    return;
                }
                
                if (!chinese) {
                    alert('Please enter a Chinese translation.');
                    return;
                }
                
                if (editId) {
                    // 编辑现有单词
                    VocabData.addWord({
                        id: parseInt(editId),
                        english: english,
                        chinese: chinese
                    });
                } else {
                    // 添加新单词
                    VocabData.addWord({ english: english, chinese: chinese });
                }
                
                document.getElementById('add-word-dialog').classList.add('hidden');
            });
            
            // 初始化错词表显示
            function renderMistakes() {
                const mistakes = MistakeManager.getMistakes();
                const mistakesList = document.getElementById('mistakes-list');
                const noMistakesMessage = document.getElementById('no-mistakes-message');
                const mistakesCount = document.getElementById('mistakes-count');
                const clearMistakesBtn = document.getElementById('clear-mistakes-btn');
                const testMistakesBtn = document.getElementById('test-mistakes-btn');
                
                mistakesCount.textContent = mistakes.length;
                clearMistakesBtn.disabled = mistakes.length === 0;
                testMistakesBtn.disabled = mistakes.length === 0;
                
                if (mistakes.length === 0) {
                    mistakesList.innerHTML = '';
                    noMistakesMessage.classList.remove('hidden');
                    return;
                }
                
                noMistakesMessage.classList.add('hidden');
                mistakesList.innerHTML = '';
                
                mistakes.forEach(mistake => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-custom';
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="font-medium text-gray-900">${mistake.english}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="text-gray-600">${mistake.chinese}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-danger/10 text-danger">
                                ${mistake.mistakeCount}
                            </span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-secondary/10 text-secondary">
                                ${mistake.correctStreak}/3
                            </span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                            <button class="text-danger hover:text-danger/80 remove-mistake" data-id="${mistake.wordId}">
                                <i class="fa fa-trash"></i> Remove
                            </button>
                        </td>
                    `;
                    mistakesList.appendChild(row);
                });
                
                // 添加删除单个错词的事件监听
                document.querySelectorAll('.remove-mistake').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const wordId = parseInt(this.getAttribute('data-id'));
                        MistakeManager.removeMistake(wordId);
                    });
                });
            }
            
            // 错词表搜索功能
            document.getElementById('search-mistakes').addEventListener('input', function(e) {
                const query = e.target.value;
                const filteredMistakes = MistakeManager.searchMistakes(query);
                const mistakesList = document.getElementById('mistakes-list');
                
                mistakesList.innerHTML = '';
                
                filteredMistakes.forEach(mistake => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-custom';
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="font-medium text-gray-900">${mistake.english}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="text-gray-600">${mistake.chinese}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-danger/10 text-danger">
                                ${mistake.mistakeCount}
                            </span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-secondary/10 text-secondary">
                                ${mistake.correctStreak}/3
                            </span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                            <button class="text-danger hover:text-danger/80 remove-mistake" data-id="${mistake.wordId}">
                                <i class="fa fa-trash"></i> Remove
                            </button>
                        </td>
                    `;
                    mistakesList.appendChild(row);
                });
                
                // 重新绑定删除事件
                document.querySelectorAll('.remove-mistake').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const wordId = parseInt(this.getAttribute('data-id'));
                        MistakeManager.removeMistake(wordId);
                    });
                });
            });
            
            // 清空错词表
            document.getElementById('clear-mistakes-btn').addEventListener('click', function() {
                showConfirmDialog(
                    'Clear All Mistakes',
                    'Are you sure you want to clear all mistake words?',
                    () => {
                        MistakeManager.clearAllMistakes();
                    }
                );
            });
            
            // 测试错词
            document.getElementById('test-mistakes-btn').addEventListener('click', function() {
                const mistakes = MistakeManager.getMistakes();
                if (mistakes.length === 0) {
                    alert('没有错词可以测试！');
                    return;
                }
                
                // 切换到测试页面
                document.getElementById('nav-test').click();
                
                // 设置测试参数
                document.querySelector('input[name="test-type"][value="english-to-chinese-multiple"]').checked = true;
                document.querySelector('input[name="test-order"][value="random"]').checked = true;
                
                // 设置测试数量为错词数量
                document.getElementById('test-count').value = mistakes.length;
                
                // 启动测试，确保只使用错词列表中的单词
                setTimeout(() => {
                    // 获取错词对应的单词数据
                    const mistakeWordIds = mistakes.map(mistake => mistake.wordId);
                    const allWords = VocabData.getWords();
                    const mistakeWords = allWords.filter(word => mistakeWordIds.includes(word.id));
                    
                    if (mistakeWords.length === 0) {
                        alert('无法找到对应的错词数据！');
                        return;
                    }
                    
                    // 使用错词列表中的单词进行测试
                    const testType = document.querySelector('input[name="test-type"]:checked').value;
                    const test = TestManager.startTest({
                        testType,
                        words: mistakeWords, // 只使用错词列表中的单词
                        order: 'random'
                    });
                    
                    // 显示测试进行中界面
                    document.getElementById('test-settings').classList.add('hidden');
                    document.getElementById('test-in-progress').classList.remove('hidden');
                    document.getElementById('test-results').classList.add('hidden');
                    
                    // 更新进度信息
                    document.getElementById('total-questions').textContent = test.totalQuestions;
                    document.getElementById('current-question').textContent = '1';
                    
                    // 显示第一个问题
                    showCurrentQuestion();
                }, 500);
            });
            
            // 更新最大单词数文本
            function updateMaxWordsText() {
                const wordCount = VocabData.getWords().length;
                document.getElementById('max-words-text').textContent = `max: ${wordCount}`;
                
                // 限制测试数量不超过单词总数
                const testCountInput = document.getElementById('test-count');
                if (parseInt(testCountInput.value) > wordCount || wordCount === 0) {
                    testCountInput.value = Math.min(parseInt(testCountInput.value), wordCount);
                }
                
                testCountInput.max = wordCount;
            }
            
            // 更新开始测试按钮状态
            function updateStartTestButtonState() {
                const wordCount = VocabData.getWords().length;
                const testCount = parseInt(document.getElementById('test-count').value) || 0;
                document.getElementById('start-test-btn').disabled = wordCount === 0 || testCount === 0 || testCount > wordCount;
            }
            
            // 测试数量变化时更新按钮状态
            document.getElementById('test-count').addEventListener('input', updateStartTestButtonState);
            
            // 开始测试
            document.getElementById('start-test-btn').addEventListener('click', function() {
                const testType = document.querySelector('input[name="test-type"]:checked').value;
                const testOrder = document.querySelector('input[name="test-order"]:checked').value;
                const testCount = parseInt(document.getElementById('test-count').value);
                
                const test = TestManager.startTest({
                    testType,
                    order: testOrder,
                    count: testCount
                });
                
                if (test.words.length === 0) {
                    alert('No words available for testing. Please add some words first.');
                    return;
                }
                
                // 显示测试进行中界面
                document.getElementById('test-settings').classList.add('hidden');
                document.getElementById('test-in-progress').classList.remove('hidden');
                document.getElementById('test-results').classList.add('hidden');
                
                // 更新进度信息
                document.getElementById('total-questions').textContent = test.totalQuestions;
                document.getElementById('current-question').textContent = '1';
                
                // 强制在UI更新后显示第一个问题，解决iOS Safari兼容性问题
                setTimeout(() => {
                    showCurrentQuestion();
                }, 50);
            });
            
            // 选择题选项点击事件 - 直接提交答案
            document.getElementById('options-container').addEventListener('click', function(e) {
                const option = e.target.closest('.option-hover');
                if (option && option.hasAttribute('data-option')) {
                    const userAnswer = option.getAttribute('data-option');
                    submitAnswer(userAnswer);
                }
            });
            
            // 句子填空选项点击事件
            document.getElementById('sentence-options-container').addEventListener('click', function(e) {
                const option = e.target.closest('.option-hover');
                if (option && option.hasAttribute('data-option')) {
                    const userAnswer = option.getAttribute('data-option');
                    submitAnswer(userAnswer);
                }
            });
            
            // 提交答案按钮
            document.getElementById('submit-answer-btn').addEventListener('click', function() {
                const testType = TestManager.currentTest?.settings.testType;
                if (!testType) return;
                
                let userAnswer;
                if (testType === 'english-to-chinese' || testType === 'chinese-to-english') {
                    userAnswer = document.getElementById('test-answer').value.trim();
                    if (!userAnswer) {
                        alert('Please enter your answer.');
                        return;
                    }
                    submitAnswer(userAnswer);
                }
            });
            
            // 提交答案函数
            function submitAnswer(userAnswer) {
                const result = TestManager.submitAnswer(userAnswer);
                if (!result) return;
                
                // 隐藏导航按钮
                document.getElementById('test-navigation').classList.add('hidden');
                
                // 显示反馈
                const feedback = document.getElementById('answer-feedback');
                const feedbackIcon = document.getElementById('feedback-icon');
                const feedbackTitle = document.getElementById('feedback-title');
                const feedbackMessage = document.getElementById('feedback-message');
                
                feedback.classList.remove('hidden');
                
                if (result.result.isCorrect) {
                    feedback.className = 'mt-6 p-4 rounded-lg bg-secondary/10 border border-secondary/30';
                    feedbackIcon.className = 'fa fa-check-circle text-secondary text-xl mt-0.5 mr-3';
                    feedbackTitle.className = 'font-medium text-secondary';
                    feedbackTitle.textContent = 'Correct!';
                    feedbackMessage.textContent = `The answer is ${result.result.correctAnswer}`;
                } else {
                    feedback.className = 'mt-6 p-4 rounded-lg bg-danger/10 border border-danger/30';
                    feedbackIcon.className = 'fa fa-times-circle text-danger text-xl mt-0.5 mr-3';
                    feedbackTitle.className = 'font-medium text-danger';
                    feedbackTitle.textContent = 'Incorrect';
                    feedbackMessage.textContent = `The correct answer is ${result.result.correctAnswer}`;
                }
                
                // 如果是最后一题，修改按钮文本
                if (result.isLastQuestion) {
                    document.getElementById('next-question-btn').textContent = 'View Results';
                } else {
                    document.getElementById('next-question-btn').textContent = 'Next Question';
                }
            }
            
            // 跳过问题
            document.getElementById('skip-question-btn').addEventListener('click', function() {
                const question = TestManager.getCurrentQuestion();
                if (!question) return;
                
                // 记录为错误答案
                TestManager.submitAnswer('');
                
                // 显示下一题
                if (TestManager.currentQuestionIndex < TestManager.currentTest.totalQuestions) {
                    showCurrentQuestion();
                    document.getElementById('current-question').textContent = TestManager.currentQuestionIndex + 1;
                } else {
                    showTestResults();
                }
            });
            
            // 下一题按钮
            document.getElementById('next-question-btn').addEventListener('click', function() {
                const currentTest = TestManager.currentTest;
                if (!currentTest) return;
                
                // 如果是最后一题，显示结果
                if (TestManager.currentQuestionIndex >= currentTest.totalQuestions) {
                    showTestResults();
                    return;
                }
                
                // 隐藏反馈，显示导航
                document.getElementById('answer-feedback').classList.add('hidden');
                document.getElementById('test-navigation').classList.remove('hidden');
                
                // 显示当前问题
                showCurrentQuestion();
                
                // 更新进度
                document.getElementById('current-question').textContent = TestManager.currentQuestionIndex + 1;
            });
            
            // 显示当前问题
            function showCurrentQuestion() {
                const question = TestManager.getCurrentQuestion();
                if (!question) return;
                
                // 隐藏所有问题容器
                document.getElementById('input-test-container').classList.add('hidden');
                document.getElementById('multiple-choice-container').classList.add('hidden');
                document.getElementById('sentence-test-container').classList.add('hidden');
                
                // 根据问题类型显示相应容器
                switch (question.type) {
                    case 'english-to-chinese':
                    case 'chinese-to-english':
                        // 输入式测试
                        const inputContainer = document.getElementById('input-test-container');
                        inputContainer.classList.remove('hidden');
                        document.getElementById('test-question').textContent = question.question;
                        document.getElementById('test-answer').value = '';
                        document.getElementById('test-answer').focus();
                        break;
                        
                    case 'english-to-chinese-multiple':
                    case 'chinese-to-english-multiple':
                        // 选择题测试 - 6个选项
                        const mcContainer = document.getElementById('multiple-choice-container');
                        mcContainer.classList.remove('hidden');
                        document.getElementById('mc-question').textContent = question.question;
                        
                        const optionsContainer = document.getElementById('options-container');
                        optionsContainer.innerHTML = '';
                        
                        // 添加选项
                        question.options.forEach(option => {
                            const optionDiv = document.createElement('div');
                            optionDiv.className = 'option-hover p-4 border border-gray-200 rounded-lg';
                            optionDiv.setAttribute('data-option', option);
                            optionDiv.innerHTML = `
                                <div class="flex items-center">
                                    <div class="w-6 h-6 rounded-full border border-gray-300 flex-shrink-0 mr-3 flex items-center justify-center">
                                        <div class="w-3 h-3 rounded-full bg-primary hidden option-check"></div>
                                    </div>
                                    <span>${option}</span>
                                </div>
                            `;
                            optionsContainer.appendChild(optionDiv);
                        });
                        break;
                        
                    case 'sentence-completion':
                        // 句子填空测试
                        const sentenceContainer = document.getElementById('sentence-test-container');
                        sentenceContainer.classList.remove('hidden');
                        document.getElementById('sentence-question').textContent = question.question;
                        
                        const sentenceOptionsContainer = document.getElementById('sentence-options-container');
                        sentenceOptionsContainer.innerHTML = '';
                        
                        question.options.forEach(option => {
                            const optionDiv = document.createElement('div');
                            optionDiv.className = 'option-hover p-3 border border-gray-200 rounded-lg';
                            optionDiv.setAttribute('data-option', option);
                            optionDiv.textContent = option;
                            sentenceOptionsContainer.appendChild(optionDiv);
                        });
                        break;
                }
            }
            
            // 显示测试结果
            function showTestResults() {
                const results = TestManager.getTestResults();
                
                // 更新结果显示
                document.getElementById('test-score').textContent = `${results.score}%`;
                document.getElementById('result-total').textContent = results.total;
                document.getElementById('result-correct').textContent = results.correct;
                document.getElementById('result-incorrect').textContent = results.incorrect;
                
                // 更新详细结果
                const detailedContainer = document.getElementById('detailed-results');
                detailedContainer.innerHTML = '';
                
                results.answers.forEach((answer, index) => {
                    const resultItem = document.createElement('div');
                    resultItem.className = `p-3 rounded-lg ${answer.isCorrect ? 'bg-secondary/5 border border-secondary/20' : 'bg-danger/5 border border-danger/20'}`;
                    
                    resultItem.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm font-medium ${answer.isCorrect ? 'text-secondary' : 'text-danger'}">
                                    Question ${index + 1}: ${answer.question}
                                </p>
                                <p class="text-sm mt-1">
                                    <span class="text-gray-500">Your answer: </span>${answer.userAnswer || 'Skipped'}
                                </p>
                                <p class="text-sm mt-1">
                                    <span class="text-gray-500">Correct answer: </span>${answer.correctAnswer}
                                </p>
                            </div>
                            <span class="text-xs font-semibold px-2 py-1 rounded-full ${answer.isCorrect ? 'bg-secondary/10 text-secondary' : 'bg-danger/10 text-danger'}">
                                ${answer.isCorrect ? 'Correct' : 'Incorrect'}
                            </span>
                        </div>
                    `;
                    
                    detailedContainer.appendChild(resultItem);
                });
                
                // 显示结果界面
                document.getElementById('test-in-progress').classList.add('hidden');
                document.getElementById('test-results').classList.remove('hidden');
                
                // 更新复习错词按钮状态
                document.getElementById('review-mistakes-btn').disabled = results.incorrect === 0;
            }
            
            // 重新测试
            document.getElementById('restart-test-btn').addEventListener('click', function() {
                document.getElementById('test-results').classList.add('hidden');
                document.getElementById('test-settings').classList.remove('hidden');
            });
            
            // 复习错词
            document.getElementById('review-mistakes-btn').addEventListener('click', function() {
                document.getElementById('nav-mistakes').click();
            });
            
            // 保存测试结果
            document.getElementById('save-results-btn').addEventListener('click', function() {
                const results = TestManager.getTestResults();
                ResultsManager.saveResult(results);
                alert('Test results saved successfully!');
                document.getElementById('test-results').classList.add('hidden');
                document.getElementById('test-settings').classList.remove('hidden');
            });
            
            // 渲染测试结果历史
            function renderTestHistory() {
                const results = ResultsManager.getResults();
                const resultsList = document.getElementById('results-list');
                const noResultsMessage = document.getElementById('no-results-message');
                const clearResultsBtn = document.getElementById('clear-results-btn');
                const resultsChartContainer = document.getElementById('results-chart-container');
                
                clearResultsBtn.disabled = results.length === 0;
                
                if (results.length === 0) {
                    resultsList.innerHTML = '';
                    noResultsMessage.classList.remove('hidden');
                    resultsChartContainer.classList.add('hidden');
                    return;
                }
                
                noResultsMessage.classList.add('hidden');
                resultsChartContainer.classList.remove('hidden');
                
                // 按日期排序（最新的在前）
                const sortedResults = [...results].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                resultsList.innerHTML = '';
                
                sortedResults.forEach((result, index) => {
                    // 格式化日期
                    const date = new Date(result.date);
                    const formattedDate = date.toLocaleDateString('zh-CN', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    // 测试类型显示文本
                    let testTypeText = 'Unknown';
                    switch (result.testType) {
                        case 'english-to-chinese':
                            testTypeText = 'English → Chinese (Type)';
                            break;
                        case 'chinese-to-english':
                            testTypeText = 'Chinese → English (Type)';
                            break;
                        case 'english-to-chinese-multiple':
                            testTypeText = 'English → Chinese (Multiple Choice)';
                            break;
                        case 'sentence-completion':
                            testTypeText = 'Sentence Completion';
                            break;
                    }
                    
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-custom';
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="text-gray-800">${formattedDate}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="text-gray-600">${testTypeText}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${result.score >= 80 ? 'bg-green-100 text-green-800' : result.score >= 60 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                                ${result.score}%
                            </span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="text-gray-600">${result.total}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="text-green-600">${result.correct}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="text-red-600">${result.incorrect}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                            <button class="text-primary hover:text-primary/80 view-result mr-3" data-index="${sortedResults.length - 1 - index}">
                                <i class="fa fa-eye"></i> View
                            </button>
                            <button class="text-danger hover:text-danger/80 delete-result" data-index="${sortedResults.length - 1 - index}">
                                <i class="fa fa-trash"></i> Delete
                            </button>
                        </td>
                    `;
                    resultsList.appendChild(row);
                });
                
                // 添加查看结果事件监听
                document.querySelectorAll('.view-result').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        const result = ResultsManager.getResults()[index];
                        showSavedTestResults(result);
                    });
                });
                
                // 添加删除结果事件监听
                document.querySelectorAll('.delete-result').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        showConfirmDialog(
                            'Delete Test Result',
                            'Are you sure you want to delete this test result?',
                            () => {
                                ResultsManager.deleteResult(index);
                            }
                        );
                    });
                });
                
                // 更新图表
                updateResultsChart(sortedResults);
            }
            
            // 更新结果图表
            function updateResultsChart(results) {
                const ctx = document.getElementById('results-chart').getContext('2d');
                
                // 准备图表数据（最多显示最近10次测试）
                const recentResults = results.slice(0, 10).reverse();
                const labels = recentResults.map(r => {
                    const date = new Date(r.date);
                    return date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
                });
                const scores = recentResults.map(r => r.score);
                
                // 销毁现有图表（如果存在）
                if (window.resultsChart) {
                    window.resultsChart.destroy();
                }
                
                // 创建新图表
                window.resultsChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Test Score (%)',
                            data: scores,
                            borderColor: '#165DFF',
                            backgroundColor: 'rgba(22, 93, 255, 0.1)',
                            tension: 0.3,
                            fill: true,
                            pointBackgroundColor: '#165DFF',
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    stepSize: 20
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
            
            // 显示保存的测试结果
            function showSavedTestResults(result) {
                // 更新结果显示
                document.getElementById('test-score').textContent = `${result.score}%`;
                document.getElementById('result-total').textContent = result.total;
                document.getElementById('result-correct').textContent = result.correct;
                document.getElementById('result-incorrect').textContent = result.incorrect;
                
                // 更新详细结果
                const detailedContainer = document.getElementById('detailed-results');
                detailedContainer.innerHTML = '';
                
                result.answers.forEach((answer, index) => {
                    const resultItem = document.createElement('div');
                    resultItem.className = `p-3 rounded-lg ${answer.isCorrect ? 'bg-secondary/5 border border-secondary/20' : 'bg-danger/5 border border-danger/20'}`;
                    
                    resultItem.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm font-medium ${answer.isCorrect ? 'text-secondary' : 'text-danger'}">
                                    Question ${index + 1}: ${answer.question}
                                </p>
                                <p class="text-sm mt-1">
                                    <span class="text-gray-500">Your answer: </span>${answer.userAnswer || 'Skipped'}
                                </p>
                                <p class="text-sm mt-1">
                                    <span class="text-gray-500">Correct answer: </span>${answer.correctAnswer}
                                </p>
                            </div>
                            <span class="text-xs font-semibold px-2 py-1 rounded-full ${answer.isCorrect ? 'bg-secondary/10 text-secondary' : 'bg-danger/10 text-danger'}">
                                ${answer.isCorrect ? 'Correct' : 'Incorrect'}
                            </span>
                        </div>
                    `;
                    
                    detailedContainer.appendChild(resultItem);
                });
                
                // 显示结果界面
                document.getElementById('test-settings').classList.add('hidden');
                document.getElementById('test-in-progress').classList.add('hidden');
                document.getElementById('test-results').classList.remove('hidden');
                
                // 更新按钮状态和文本
                document.getElementById('review-mistakes-btn').disabled = result.incorrect === 0;
                document.getElementById('save-results-btn').textContent = 'Back to History';
                document.getElementById('save-results-btn').onclick = function() {
                    document.getElementById('test-results').classList.add('hidden');
                    document.getElementById('results-section').classList.remove('hidden');
                    document.getElementById('save-results-btn').textContent = 'Save Results';
                    document.getElementById('save-results-btn').onclick = function() {
                        const results = TestManager.getTestResults();
                        ResultsManager.saveResult(results);
                        alert('Test results saved successfully!');
                    };
                };
            }
            
            // 前往测试页面
            document.getElementById('go-to-test-btn').addEventListener('click', function() {
                document.getElementById('nav-test').click();
            });
            
            // 清空测试结果历史
            document.getElementById('clear-results-btn').addEventListener('click', function() {
                showConfirmDialog(
                    'Clear Test History',
                    'Are you sure you want to delete all test results?',
                    () => {
                        ResultsManager.clearAllResults();
                    }
                );
            });
            
            // 显示确认对话框
            function showConfirmDialog(title, message, confirmCallback) {
                const dialog = document.getElementById('confirm-dialog');
                const dialogTitle = document.getElementById('confirm-title');
                const dialogMessage = document.getElementById('confirm-message');
                const confirmOk = document.getElementById('confirm-ok');
                const confirmCancel = document.getElementById('confirm-cancel');
                
                // 设置对话框内容
                dialogTitle.textContent = title;
                dialogMessage.textContent = message;
                
                // 显示对话框
                dialog.classList.remove('hidden');
                
                // 确认按钮事件
                const okHandler = function() {
                    confirmCallback();
                    dialog.classList.add('hidden');
                    confirmOk.removeEventListener('click', okHandler);
                    confirmCancel.removeEventListener('click', cancelHandler);
                };
                
                // 取消按钮事件
                const cancelHandler = function() {
                    dialog.classList.add('hidden');
                    confirmOk.removeEventListener('click', okHandler);
                    confirmCancel.removeEventListener('click', cancelHandler);
                };
                
                confirmOk.addEventListener('click', okHandler);
                confirmCancel.addEventListener('click', cancelHandler);
            }
            
            // 初始化页面
            function init() {
                // 渲染单词列表
                renderWords();
                // 渲染错词表
                renderMistakes();
                // 渲染测试结果历史
                renderTestHistory();
                
                // 更新最大单词数
                updateMaxWordsText();
                
                // 监听单词更新事件
                document.addEventListener('wordsUpdated', function() {
                    renderWords();
                    updateMaxWordsText();
                    updateStartTestButtonState();
                });
                
                // 监听错词更新事件
                document.addEventListener('mistakesUpdated', function() {
                    renderMistakes();
                });
                
                // 监听测试结果更新事件
                document.addEventListener('resultsUpdated', function() {
                    renderTestHistory();
                });
            }
            
            // 启动初始化
            init();
        });
    </script>
</body>
</html>
